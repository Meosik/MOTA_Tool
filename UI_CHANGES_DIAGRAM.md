# MAP Mode UI ë³€ê²½ì‚¬í•­ ì‹œê°í™”

## ë³€ê²½ ì „ (Before)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TopBar (MOTA ëª¨ë“œë§Œ ì‚¬ìš©)                                          â”‚
â”‚ [MOTA â–¼] [í”„ë ˆì„ í´ë” ì—´ê¸°] [GT ë¶ˆëŸ¬ì˜¤ê¸°] [Pred ë¶ˆëŸ¬ì˜¤ê¸°]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚                            â”‚                    â”‚
â”‚ Sidebar      â”‚  Canvas (ì¤‘ì•™)             â”‚  Control Panel     â”‚
â”‚              â”‚                            â”‚                    â”‚
â”‚ Images       â”‚                            â”‚  Upload GT         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                            â”‚  Upload Pred       â”‚
â”‚ â”‚Upload    â”‚ â”‚  [ì´ë¯¸ì§€ í‘œì‹œ]             â”‚  Export            â”‚
â”‚ â”‚Folder    â”‚ â”‚                            â”‚                    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                            â”‚  [Thresholds]      â”‚
â”‚              â”‚  [Bbox í‘œì‹œ]               â”‚                    â”‚
â”‚ [ì´ë¯¸ì§€ ëª©ë¡] â”‚                            â”‚  [Metrics]         â”‚
â”‚              â”‚                            â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë¬¸ì œì **:
- âŒ ì—…ë¡œë“œ ë²„íŠ¼ì´ ë¶„ì‚°ë¨ (Sidebar, Control Panel)
- âŒ MOTAì™€ ë‹¤ë¥¸ UX (TopBar vs íŒ¨ë„)
- âŒ 404 ì—ëŸ¬ ë°œìƒ (API URL ë¬¸ì œ)

---

## ë³€ê²½ í›„ (After)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TopBar (MOTA & MAP ëª¨ë‘ ì‚¬ìš©) âœ…                                       â”‚
â”‚                                                                     â”‚
â”‚ MOTA ëª¨ë“œ:                                                           â”‚
â”‚ [MOTA â–¼] [í”„ë ˆì„ í´ë” ì—´ê¸°] [GT ë¶ˆëŸ¬ì˜¤ê¸°] [Pred ë¶ˆëŸ¬ì˜¤ê¸°] ... [ë‚´ë³´ë‚´ê¸°] â”‚
â”‚                                                                     â”‚
â”‚ MAP ëª¨ë“œ:                                                            â”‚
â”‚ [MAP â–¼] [ì´ë¯¸ì§€/COCO ì—…ë¡œë“œ] [GT ì–´ë…¸í…Œì´ì…˜] [Pred ì–´ë…¸í…Œì´ì…˜] ... [ë‚´ë³´ë‚´ê¸°] â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚                            â”‚                    â”‚
â”‚ Sidebar      â”‚  Canvas (ì¤‘ì•™)             â”‚  Control Panel     â”‚
â”‚              â”‚                            â”‚                    â”‚
â”‚ Images       â”‚                            â”‚  ğŸ’¡ TopBarì—ì„œ     â”‚
â”‚              â”‚                            â”‚  ì—…ë¡œë“œí•˜ì„¸ìš”      â”‚
â”‚ ğŸ’¡ TopBarì—ì„œâ”‚  [ì´ë¯¸ì§€ í‘œì‹œ]             â”‚                    â”‚
â”‚ ì—…ë¡œë“œí•˜ì„¸ìš” â”‚                            â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚              â”‚                            â”‚                    â”‚
â”‚ [ì´ë¯¸ì§€ ëª©ë¡] â”‚  [Bbox í‘œì‹œ]               â”‚  [Thresholds]      â”‚
â”‚              â”‚  - GT (ë…¹ìƒ‰)               â”‚  - Confidence      â”‚
â”‚              â”‚  - Pred (ìƒ‰ìƒë³„)           â”‚  - IoU             â”‚
â”‚              â”‚                            â”‚                    â”‚
â”‚              â”‚  [Interactive í¸ì§‘]         â”‚  [Metrics]         â”‚
â”‚              â”‚  - 8-handle resize         â”‚  - mAP             â”‚
â”‚              â”‚  - Category ë³€ê²½           â”‚  - Per-class AP    â”‚
â”‚              â”‚                            â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ê°œì„ ì‚¬í•­**:
- âœ… TopBarì—ì„œ ëª¨ë“  ì—…ë¡œë“œ í†µí•©
- âœ… MOTAì™€ ì¼ê´€ëœ UX
- âœ… 404 ì—ëŸ¬ í•´ê²° (API_BASE ì‚¬ìš©)
- âœ… ì§ê´€ì ì¸ ì›Œí¬í”Œë¡œìš°

---

## ìƒíƒœ ê´€ë¦¬ íë¦„

### ë³€ê²½ ì „
```
MapPage (local state)
  â”œâ”€ folderId
  â”œâ”€ gtId
  â””â”€ predId
     â”‚
     â”œâ”€â†’ MapImageSidebar (prop)
     â”œâ”€â†’ MapControlPanel (prop)
     â””â”€â†’ MapImageCanvas (prop)
```

### ë³€ê²½ í›„
```
MapContext (central state) âœ…
  â”œâ”€ folderId
  â”œâ”€ gtId
  â”œâ”€ predId
  â”œâ”€ imageId
  â””â”€ projectId
     â”‚
     â”œâ”€â†’ TopBar (useMapContext)
     â”œâ”€â†’ MapPage (useMapContext)
     â”œâ”€â†’ MapImageSidebar (useMapContext)
     â””â”€â†’ MapControlPanel (useMapContext)
```

**ì¥ì **:
- ì¤‘ì•™ ì§‘ì¤‘ì‹ ìƒíƒœ ê´€ë¦¬
- Prop drilling ì œê±°
- TopBarì—ì„œ ì§ì ‘ ìƒíƒœ ì—…ë°ì´íŠ¸

---

## API í˜¸ì¶œ ìˆ˜ì •

### ë³€ê²½ ì „ (âŒ 404 ì—ëŸ¬)
```javascript
// mapStore.ts
fetch('/images/folder', ...)        // âŒ ìƒëŒ€ ê²½ë¡œ
fetch('/annotations', ...)          // âŒ ìƒëŒ€ ê²½ë¡œ

// mapApi.ts
fetch('/images/${folderId}', ...)   // âŒ ìƒëŒ€ ê²½ë¡œ
fetch('/map/calculate?...', ...)    // âŒ ìƒëŒ€ ê²½ë¡œ
```

### ë³€ê²½ í›„ (âœ… ì •ìƒ ì‘ë™)
```javascript
import { API_BASE } from '../lib/api';

// mapStore.ts
fetch(`${API_BASE}/images/folder`, ...)     // âœ… http://127.0.0.1:8000/images/folder
fetch(`${API_BASE}/annotations`, ...)       // âœ… http://127.0.0.1:8000/annotations

// mapApi.ts
fetch(`${API_BASE}/images/${folderId}`, ...)   // âœ… ì ˆëŒ€ ê²½ë¡œ
fetch(`${API_BASE}/map/calculate?...`, ...)    // âœ… ì ˆëŒ€ ê²½ë¡œ
```

---

## ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤

### Scenario: MAP ëª¨ë“œë¡œ mAP ê³„ì‚°

#### 1ë‹¨ê³„: ì´ë¯¸ì§€ í´ë” ì—…ë¡œë“œ
```
[TopBar]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ì´ë¯¸ì§€/COCO ì—…ë¡œë“œ] â† í´ë¦­     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
   í´ë” ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸
         â†“
   âœ… "ì´ë¯¸ì§€ í´ë” ì—…ë¡œë“œ ì„±ê³µ"
         â†“
   [Sidebar] ì´ë¯¸ì§€ ëª©ë¡ í‘œì‹œ
```

#### 2ë‹¨ê³„: GT ì—…ë¡œë“œ
```
[TopBar]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [GT ì–´ë…¸í…Œì´ì…˜] â† í´ë¦­          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
   COCO JSON íŒŒì¼ ì„ íƒ
         â†“
   âœ… "GT ì—…ë¡œë“œ ì„±ê³µ"
         â†“
   [Canvas] GT bbox (ë…¹ìƒ‰) í‘œì‹œ
```

#### 3ë‹¨ê³„: Predictions ì—…ë¡œë“œ
```
[TopBar]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Pred ì–´ë…¸í…Œì´ì…˜] â† í´ë¦­        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
   COCO JSON íŒŒì¼ ì„ íƒ
         â†“
   âœ… "Pred ì—…ë¡œë“œ ì„±ê³µ"
         â†“
   [Canvas] Pred bbox (ìƒ‰ìƒë³„) í‘œì‹œ
   [Control Panel] mAP ìë™ ê³„ì‚°
```

#### 4ë‹¨ê³„: í™•ì¸ ë° ë‚´ë³´ë‚´ê¸°
```
[Control Panel]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Metrics              â”‚
â”‚ mAP: 85.2%           â”‚
â”‚ Person: 90.1%        â”‚
â”‚ Car: 80.3%           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[TopBar]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ë‚´ë³´ë‚´ê¸°] â† í´ë¦­               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
   predictions_xxx.json ë‹¤ìš´ë¡œë“œ
```

---

## ì½”ë“œ ë³€ê²½ ìš”ì•½

### ìˆ˜ì •ëœ íŒŒì¼ (7ê°œ)

1. **`mapStore.ts`** (API URL ìˆ˜ì •)
   ```typescript
   - fetch('/images/folder', ...)
   + fetch(`${API_BASE}/images/folder`, ...)
   ```

2. **`mapApi.ts`** (API URL ìˆ˜ì •)
   ```typescript
   - fetch('/map/calculate?...', ...)
   + fetch(`${API_BASE}/map/calculate?...`, ...)
   ```

3. **`TopBar.tsx`** (MAP ëª¨ë“œ í•¸ë“¤ëŸ¬)
   ```typescript
   const { setFolderId, setGtId, setPredId } = useMapContext();
   const openMapFolder = () => openMapFolderStore(id => {
     setFolderId(id);
     setImageId(1);
   });
   ```

4. **`MapContext.tsx`** (ìƒíƒœ ì¶”ê°€)
   ```typescript
   + const [folderId, setFolderId] = useState<string | null>(null);
   + const [gtId, setGtId] = useState<string | null>(null);
   + const [predId, setPredId] = useState<string | null>(null);
   ```

5. **`MapPage.tsx`** (Context ì‚¬ìš©)
   ```typescript
   - const [folderId, setFolderId] = useState<string | null>(null);
   + const { folderId, setFolderId } = useMapContext();
   ```

6. **`MapImageSidebar.tsx`** (ë²„íŠ¼ ì œê±°)
   ```typescript
   - <button onClick={handleUploadFolder}>Upload Folder</button>
   + <div>TopBarì—ì„œ ì´ë¯¸ì§€ í´ë”ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
   ```

7. **`MapControlPanel.tsx`** (ë²„íŠ¼ ì œê±°)
   ```typescript
   - <button onClick={handleUploadGT}>Upload GT</button>
   - <button onClick={handleUploadPred}>Upload Predictions</button>
   + <div>ğŸ’¡ TopBarì—ì„œ ì—…ë¡œë“œí•˜ê³  ë‚´ë³´ë‚´ê¸°ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
   ```

---

## ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

### âœ… ê¸°ëŠ¥ ê²€ì¦
- [x] TopBarì—ì„œ ì´ë¯¸ì§€ í´ë” ì—…ë¡œë“œ â†’ ì„±ê³µ
- [x] TopBarì—ì„œ GT ì—…ë¡œë“œ â†’ ì„±ê³µ
- [x] TopBarì—ì„œ Pred ì—…ë¡œë“œ â†’ ì„±ê³µ
- [x] mAP ìë™ ê³„ì‚° â†’ ì •ìƒ
- [x] TopBarì—ì„œ ë‚´ë³´ë‚´ê¸° â†’ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì„±ê³µ

### âœ… API í˜¸ì¶œ ê²€ì¦
- [x] `/images/folder` â†’ 200 OK
- [x] `/annotations` â†’ 200 OK
- [x] `/images/{folder_id}` â†’ 200 OK
- [x] `/map/calculate` â†’ 200 OK

### âœ… UI/UX ê²€ì¦
- [x] TopBar ë²„íŠ¼ ë¼ë²¨ ëª…í™•í•¨
- [x] ì‚¬ì´ë“œë°”/íŒ¨ë„ì— ì•ˆë‚´ ë©”ì‹œì§€
- [x] MOTA ëª¨ë“œ ì˜í–¥ ì—†ìŒ
- [x] Frontend ë¹Œë“œ ì„±ê³µ

---

## ê²°ë¡ 

### í•´ê²°ëœ ë¬¸ì œ
1. âœ… **404 ì—ëŸ¬ í•´ê²°**: API_BASE ì‚¬ìš©ìœ¼ë¡œ ëª¨ë“  API í˜¸ì¶œ ì •ìƒí™”
2. âœ… **UI í†µí•©**: TopBarë¥¼ í†µí•œ ì¼ê´€ëœ ì—…ë¡œë“œ ê²½í—˜
3. âœ… **ìƒíƒœ ê´€ë¦¬ ê°œì„ **: MapContextë¡œ ì¤‘ì•™ ì§‘ì¤‘í™”

### ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
- ì§ê´€ì ì¸ ì›Œí¬í”Œë¡œìš° (TopBar â†’ ì¤‘ì•™ ìº”ë²„ìŠ¤ â†’ ìš°ì¸¡ íŒ¨ë„)
- MOTAì™€ ì¼ê´€ëœ UX
- ëª…í™•í•œ ì•ˆë‚´ ë©”ì‹œì§€

### ê¸°ìˆ ì  ê°œì„ 
- ì¤‘ì•™ ì§‘ì¤‘ì‹ ìƒíƒœ ê´€ë¦¬
- API URL í‘œì¤€í™”
- ì»´í¬ë„ŒíŠ¸ ê°„ ê²°í•©ë„ ê°ì†Œ
